<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Inertia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="site.desc">
<meta property="og:type" content="website">
<meta property="og:title" content="Inertia">
<meta property="og:url" content="http://nberserk.github.io/page/9/index.html">
<meta property="og:site_name" content="Inertia">
<meta property="og:description" content="site.desc">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="@nberserk">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Inertia" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  
<link rel="stylesheet" href="/css/styles.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63706532-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Inertia</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          
  
    <article id="post-parquet" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/08/parquet/">Parquet + Avro + Spark</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/12/08/parquet/" class="article-date"><time datetime="2015-12-08T15:00:00.000Z" itemprop="datePublished">2015-12-09</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>데이터 분석을 위해 파일을 저장해야 할 필요가 있었다. 처음에는 csv파일 형식으로 저장을 했는데, 시간이 지남에 따라서 새로운 컬럼이 생기는 요구사항이 생겼다. 이런 경우 csv는 어떤 정보가 몇번째 컬럼에 있는지를 기술하지 않기 때문에 또 다른 파일에 컬럼 정보를 기록하고 데이터 타입등도 기술을 해줘야 하는 불편함이 생긴다.<br>언뜻 parquet이 그런 일을 하는것이라 어렴풋이 알고 있었기 때문에 이번에 parquet을 적용해 볼겸 조사를 해봤다.</p>
<p>특징들..</p>
<ul>
<li>압축 지원. 50% 정도 세이브 할 수 있다고 함. 스토리지 비용이 반이라는 얘기.</li>
<li>여러가지 serialize framework 지원 (Avro, Thrift, protocol buffer)</li>
</ul>
<h2 id="column-based"><a href="#column-based" class="headerlink" title="column based"></a>column based</h2><p>columnar storage다. 이렇게 접근한 이유는 크게 2가지.</p>
<p>보통 쿼리를 할때 모든 컬럼의 정보가 다 필요한 경우는 많지 않다. row based 라면 전체 열을 다 읽어야 쿼리를 수행할 수 있지만, parquet는 필요한 컬럼만 로드하면 된다. 여기서 속도 향샹이 생긴다.</p>
<p>그리고 컬럼끼리 모아서 압축을 하면 압축률이 더 좋아진다. timestamp를 가지는 컬럼이라고 생각하면 델터 인코딩 방식으로 압축을 하면 좋을 것이고, 각 컬럼의 특징이 살아 있으니 더 유리하다.</p>
<iframe src="//www.slideshare.net/slideshow/embed_code/key/jKNTsYfuHHgao?startSlide=33" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>

<p>2G의 원본 csv를 SNAPPY압축을 이용해서 저장하니 1G로 50%정도나 줄어들었다.</p>
<p>그리고 query performance도 일반 텍스트에 비해서 2배 정도 성능이 좋다고 한다.</p>
<iframe src="//www.slideshare.net/slideshow/embed_code/key/jKNTsYfuHHgao?startSlide=34" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<h2 id="단점"><a href="#단점" class="headerlink" title="단점"></a>단점</h2><p>마냥 좋기만 한것은 아니다. 분석용으로 최고의 파일 형식이라고 한 것은 데이터의 업데이트가 없다는 뜻이다. 즉, readonly일때 좋은 것이다.</p>
<h2 id="환경-설정"><a href="#환경-설정" class="headerlink" title="환경 설정"></a>환경 설정</h2><p>spark + parquet + avro 를 사용하려면 다음과 같은 디펜던시가 필요하다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scala.version</span>&gt;</span>2.11.4<span class="tag">&lt;/<span class="name">scala.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parquet.version</span>&gt;</span>1.8.1<span class="tag">&lt;/<span class="name">parquet.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">avro.version</span>&gt;</span>1.7.7<span class="tag">&lt;/<span class="name">avro.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.parquet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parquet-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parquet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.parquet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parquet-encoding<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parquet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.parquet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parquet-column<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parquet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.parquet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parquet-hadoop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parquet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.parquet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parquet-avro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parquet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.avro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>avro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;avro.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="avro-schema-define"><a href="#avro-schema-define" class="headerlink" title="avro schema define"></a>avro schema define</h2><p>자세한 사항은 <a href="http://avro.apache.org/docs/1.7.7/spec.html#schemas" target="_blank" rel="noopener">avro spec</a>을 보면 되고, 아래처럼 정의 하면 된다. 이 파일을 avro-tools.jar를 이용하면 POJO class를 만들 수 있고 이 파일을 이용하면 프로그래밍이 조금더 이뻐질 수 있다. 아래 read/save 예제에서 User class를 사용하는데 이것이 스키마를 바탕으로 생성된 클래스이다. 필수는 아니고 POJO class가 없을때는 GenericRecord를 사용할 수 도 있다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"namespace"</span>: <span class="string">"com.nberserk.example.avro"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"record"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"User"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">        &#123;<span class="attr">"name"</span>: <span class="string">"id"</span>, <span class="attr">"type"</span>: <span class="string">"string"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"name"</span>: <span class="string">"age"</span>,  <span class="attr">"type"</span>: <span class="string">"int"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"name"</span>: <span class="string">"weight"</span>, <span class="attr">"type"</span>:<span class="string">"float"</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="parquet-save-read-in-java"><a href="#parquet-save-read-in-java" class="headerlink" title="parquet save/read in java"></a>parquet save/read in java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Schema schema = <span class="keyword">new</span> Schema.Parser().parse(<span class="keyword">new</span> File(<span class="string">"src/test/avro/user.avro"</span>));</span><br><span class="line">File tmp = <span class="keyword">new</span> File(<span class="string">"test.parquet"</span>);</span><br><span class="line">Path path = <span class="keyword">new</span> Path(tmp.getPath());</span><br><span class="line"></span><br><span class="line">ParquetWriter&lt;GenericRecord&gt; writer = AvroParquetWriter</span><br><span class="line">    .&lt;GenericRecord&gt;builder(path)</span><br><span class="line">    .withSchema(schema)</span><br><span class="line">    .withCompressionCodec(CompressionCodecName.SNAPPY)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write a record with GenericRecord</span></span><br><span class="line">GenericRecord r = <span class="keyword">new</span> GenericData.Record(schema);</span><br><span class="line">r.put(<span class="string">"uid"</span>, <span class="string">"darren"</span>);</span><br><span class="line">r.put(<span class="string">"age"</span>, <span class="number">22</span>);</span><br><span class="line">r.put(<span class="string">"weight"</span>, <span class="number">70.0</span>);</span><br><span class="line">writer.write(r);</span><br><span class="line">writer.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// write a record using generated POJO class called User</span></span><br><span class="line"><span class="comment">ParquetWriter&lt;User&gt; writer = AvroParquetWriter.&lt;User&gt;builder(path)</span></span><br><span class="line"><span class="comment">.withCompressionCodec(CompressionCodecName.SNAPPY)</span></span><br><span class="line"><span class="comment">.withSchema(schema)</span></span><br><span class="line"><span class="comment">.build();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">User p = new Profile();</span></span><br><span class="line"><span class="comment">p.setId("darren");</span></span><br><span class="line"><span class="comment">p.setAge(22);</span></span><br><span class="line"><span class="comment">p.setWeight(70.0);</span></span><br><span class="line"><span class="comment">writer.write(p);</span></span><br><span class="line"><span class="comment">writer.close();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">AvroReadSupport.setAvroReadSchema(conf, Profile.SCHEMA$);</span><br><span class="line">ParquetReader&lt;Profile&gt; reader = AvroParquetReader.&lt;Profile&gt;builder(path)</span><br><span class="line">    .withConf(conf)</span><br><span class="line">    .build();</span><br><span class="line">Profile p1 = reader.read();</span><br><span class="line"></span><br><span class="line">assertEquals(<span class="string">"darren"</span>, p1.getUid().toString());</span><br><span class="line">assertEquals(<span class="number">22</span>, p1.getAge());</span><br><span class="line">assertEquals(<span class="number">77.0</span>, p1.getWeight());</span><br></pre></td></tr></table></figure>
<h2 id="Spark에서-parquet-읽기"><a href="#Spark에서-parquet-읽기" class="headerlink" title="Spark에서 parquet 읽기"></a>Spark에서 parquet 읽기</h2><p>spark 1.5.0 미만에서는 [[<a href="https://issues.apache.org/jira/browse/SPARK-6566][parquet로드시" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/SPARK-6566][parquet로드시</a> 익셉션을 내는 버그가 있었는데]] 그때는 스파크 버전을 1.5.0 이상으로 올리면 해결 된다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> p = sqlContext.parquetFile(<span class="string">"s3://test.parquet"</span>)</span><br><span class="line"><span class="keyword">val</span> multipleParquet = sqlContext.parquetFile(<span class="string">"s3://p1"</span>, <span class="string">"s3://p2"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="schema-merge"><a href="#schema-merge" class="headerlink" title="schema merge"></a>schema merge</h2><p>스키마가 다른 여러 parquet 파일을 로드할때는 스키마 머지가 필요한데, 스파크 1.5.0 부터는 디폴트로 옵션이 꺼져 있다. 그래서 교집합?만 로드가 된다.<br>아래처럼 mergeSchema 옵션을 켜고 하면 합집합(?)으로 로드 된다.<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> p = sqlContext.read.option(<span class="string">"mergeSchema"</span>, <span class="string">"true"</span>).parquetFile(<span class="string">"s3://v1.parquet"</span>, <span class="string">"s3://v2.parquet"</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="avro-schema-evolution"><a href="#avro-schema-evolution" class="headerlink" title="avro schema evolution"></a>avro schema evolution</h2><p>avro를 사용하면 좋은 점은 스키마 변화가 있을때 유연하게 대처할 수 있는 점인데, 아래의 경우를 생각해보자.</p>
<p>Profile은 name필드만 있었는데, v2에서 “create_time”, “newStringNullDefault”, “union” 등이 추가 되었다. create_time, newStringNullDefault은 default값이 있고, union(둘중 하나)은 union으로 선언되어졌다. 이때 Profile 스키마로 저장된 parquet파일을 Profile2로 읽으면 어떻게 될까?</p>
<p>default 값을 가진 필드는 디폴트 값이 채워지고, union들은 생략된다. 아래 예제 참고.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// Profile avro spec</span></span><br><span class="line"><span class="comment">&#123;"namespace": "com.nberserk.avro",</span></span><br><span class="line"><span class="comment"> "type": "record",</span></span><br><span class="line"><span class="comment"> "name": "Profile",</span></span><br><span class="line"><span class="comment"> "fields": [</span></span><br><span class="line"><span class="comment">     &#123;"name": "name", "type": "string"&#125;</span></span><br><span class="line"><span class="comment"> ]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// Profile2 avro spec</span></span><br><span class="line"><span class="comment">&#123;"namespace": "com.nberserk.avro",</span></span><br><span class="line"><span class="comment"> "type": "record",</span></span><br><span class="line"><span class="comment"> "name": "Profile2",</span></span><br><span class="line"><span class="comment"> "fields": [</span></span><br><span class="line"><span class="comment">     &#123;"name": "name", "type": "string"&#125;</span></span><br><span class="line"><span class="comment">     &#123;"name": "create_time", "type":"long", "default":0&#125;,</span></span><br><span class="line"><span class="comment">     &#123;"name": "union", "type": ["null", "string"]&#125;,</span></span><br><span class="line"><span class="comment">     &#123;"name": "value_default", "type": "string", "default": "null"&#125;</span></span><br><span class="line"><span class="comment"> ]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">,*/</span></span><br><span class="line">Schema schema = <span class="keyword">new</span> Schema.Parser().parse(<span class="keyword">new</span> File(<span class="string">"src/test/avro/profile.avro"</span>));</span><br><span class="line"></span><br><span class="line">File tmp = <span class="keyword">new</span> File(<span class="string">"test2.tmp"</span>);</span><br><span class="line">tmp.deleteOnExit();</span><br><span class="line">tmp.delete();</span><br><span class="line"></span><br><span class="line">Path file = <span class="keyword">new</span> Path(tmp.getPath());</span><br><span class="line">ParquetWriter&lt;GenericRecord&gt; writer = AvroParquetWriter</span><br><span class="line">    .&lt;GenericRecord&gt;builder(file)</span><br><span class="line">    .withSchema(schema)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write a record with a null value</span></span><br><span class="line">GenericRecord r = <span class="keyword">new</span> GenericData.Record(schema);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    r.put(<span class="string">"name"</span>, <span class="string">"darren"</span>);</span><br><span class="line">    writer.write(r);</span><br><span class="line">&#125;</span><br><span class="line">writer.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Let's load the same file with v2 schema</span></span><br><span class="line">Schema v2 = <span class="keyword">new</span> Schema.Parser().parse(<span class="keyword">new</span> File(<span class="string">"src/test/avro/profile2.avro"</span>));</span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">AvroReadSupport.setAvroReadSchema(conf, v2);</span><br><span class="line"></span><br><span class="line">ParquetReader&lt;GenericRecord&gt; reader = AvroParquetReader.&lt;GenericRecord&gt;builder(file)</span><br><span class="line">    .withConf(conf).build();</span><br><span class="line">GenericRecord gr = reader.read();</span><br><span class="line"></span><br><span class="line">assertEquals(<span class="string">"darren"</span>, gr.get(<span class="string">"name"</span>).toString());</span><br><span class="line">assertEquals(<span class="number">0L</span>, gr.get(<span class="string">"create_time"</span>));</span><br><span class="line">assertEquals(<span class="string">"null"</span>, gr.get(<span class="string">"newStringNullDefault"</span>).toString());</span><br></pre></td></tr></table></figure>
<h2 id="performance-comparison"><a href="#performance-comparison" class="headerlink" title="performance comparison"></a>performance comparison</h2><p>원본 사이즈, txt로는 20G, parquet로는 6.5G 정도임 row수는 1억1천 row정도의 데이터.</p>
<p>file size, 20G 파일이 parquet으로 저장하니 6.5G 정도로 작아짐. 50% 이상.<br>query, 특정 값을 가진 사용자들의 수를 쿼리하는 것을 각각 측정해보니 txt의 경우는 186초. parquet의 경우는 105초 정도가 소요됨.</p>
<p>따라서, 스토리지 용량/ 쿼리 속도 면에서 모두 만족할 만한 결과를 보임.</p>
<h2 id="trouble-shooting"><a href="#trouble-shooting" class="headerlink" title="trouble shooting"></a>trouble shooting</h2><h3 id="writing-parquet-files-to-s3-is-too-slow"><a href="#writing-parquet-files-to-s3-is-too-slow" class="headerlink" title="writing parquet files to s3 is too slow"></a>writing parquet files to s3 is too slow</h3><p>csv에서 parquet파일로 바꾸고 난후에 S3에 write 할때 시간이 너무 오래 걸려서 분석해보니 write.parquet()의 시간이 너무 오래 걸렸다. 검색을 해보니 [[<a href="http://spark.apache.org/docs/latest/sql-programming-guide.html#configuration][spark.sql.parquet.output.committer.class" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/sql-programming-guide.html#configuration][spark.sql.parquet.output.committer.class</a> 을 org.apache.spark.sql.parquet.DirectParquetOutputCommitter 로 설정]]하면 괜찮아진다는 얘기가 있다. 수정해보니 효과가 있었다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sc : SparkContext</span></span><br><span class="line">sc.hadoopConfiguration.set(<span class="string">"spark.sql.parquet.output.committer.class"</span>, <span class="string">"org.apache.spark.sql.parquet.DirectParquetOutputCommitter"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/12/10 initial draft</li>
<li>2015/12/18 add schema evolution</li>
<li>trouble shooting/s3 slow added</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/12/08/parquet/" data-id="ckqe4m41q000ircqy6zkah2hn" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/12/08/parquet/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/" rel="tag">spark</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-rddDataFrame" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/08/rddDataFrame/">RDD and DataFrame</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/12/08/rddDataFrame/" class="article-date"><time datetime="2015-12-08T15:00:00.000Z" itemprop="datePublished">2015-12-09</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>앞서 저장 용량과 분석 속도를 위해서 parquet을 <a href="http://nberserk.github.io/2015/12/09/parquet/">도입했다는 얘기</a>를 했는데, parquet 으로 로드를 하면 DataFrame으로 로딩이 된다. DataFrame은 RDD + Schema로 볼 수 있겠다.</p>
<p>DataFraem의 경우 쿼리에는 최적화 되어 있지만(읽기 전용), 변환을 하고자 한다면 아무래도 rdd가 더 편한것이 사실이다. 이것을 변환을 하려면 RDD로 변경을 하고, 다시 DataFrame으로 변경을 해야 한다. 이것에 관련된 것들을 알아보자.</p>
<h2 id="DataFrame-RDD"><a href="#DataFrame-RDD" class="headerlink" title="DataFrame  RDD"></a>DataFrame <-> RDD</-></h2><p>DataFrame을 뭔가 변환을 하려면, rdd로 변환후 하는게 편한데 변환은 아주 쉽다. DataFrame은 rdd라는 함수를 가지고 있으니 그것만 불러주면 된다.</p>
<p>RDD를 DataFrame으로 변환하는 방법은 크게 2가지,</p>
<ul>
<li>case class를 사용하거나</li>
<li>스키마를 사용하거나</li>
</ul>
<p>아래 예제 참고</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from dataframe to rdd</span></span><br><span class="line"><span class="keyword">val</span> df = xxx</span><br><span class="line"><span class="keyword">val</span> rdd = df.rdd</span><br><span class="line"></span><br><span class="line"><span class="comment">// create DataFrame from RDD[Row]</span></span><br><span class="line"><span class="keyword">val</span> schema = <span class="type">StructType</span>(</span><br><span class="line">  <span class="type">StructField</span>(<span class="string">"name"</span>, <span class="type">StringType</span>, <span class="literal">false</span>) ::</span><br><span class="line">    <span class="type">StructField</span>(<span class="string">"age"</span>, <span class="type">IntegerType</span>, <span class="literal">true</span>) :: <span class="type">Nil</span>)</span><br><span class="line"><span class="keyword">val</span> df1 = sqlContext.createDataFrame(rdd, schema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create DataFrame from RDD[User] using case class</span></span><br><span class="line"><span class="keyword">import</span> sqlContext.implicits._</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">name:<span class="type">String</span>, age:<span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">rddUser</span> </span>= sc.textFile(<span class="string">"xx"</span>).map(l=&gt; <span class="type">User</span>(l.split(<span class="string">","</span>)(<span class="number">0</span>), l.split(<span class="string">","</span>)(<span class="number">1</span>)))</span><br><span class="line"><span class="keyword">val</span> df2 = rddUser.toDF()</span><br></pre></td></tr></table></figure>
<h2 id="Row-and-schema"><a href="#Row-and-schema" class="headerlink" title="Row and schema"></a>Row and schema</h2><p>DataFrame.rdd를 하면 RDD[Row]가 리턴되는데, Row는 getLong(i),getString(i) … 등의 함수를 가지고 있다. 그래서 타입은 DataFrame의 스키마로 알수가 있고 컬럼 명을 알면 값을 구할 수 있다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = df.rdd</span><br><span class="line"><span class="keyword">val</span> idxName = df.schema.fieldIndex(<span class="string">"name"</span>)</span><br><span class="line"><span class="keyword">val</span> idxAge = df.schema.fieldIndex(<span class="string">"age"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// age만 남게 변환</span></span><br><span class="line">rdd.map(r =&gt; _.getInt(idxAge))</span><br></pre></td></tr></table></figure>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/12/17 initial draft</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/12/08/rddDataFrame/" data-id="ckqe4m41r000jrcqy0w4r7f57" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/12/08/rddDataFrame/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/" rel="tag">spark</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-segmenttree" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/10/segmenttree/">segment tree</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/11/10/segmenttree/" class="article-date"><time datetime="2015-11-10T15:00:00.000Z" itemprop="datePublished">2015-11-11</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>트리. 트리는 알고리즘 계에서 혁신적인 발견의 하나인데, O(N)으로 걸릴 만한 것을 O(logN)으로 바꿔주는 마법 같은 data structure이다. 트리는 여러가지 쓰임새가 있지만 이중에서도 segment tree에 대해서 알아보자.</p>
<p>비슷한 용도로 쓰이는 <a href="!--￼4--">Binary Indexed Tree</a>가 있는데, 구현이 segment tree보다 간단하기 때문에 더 많이 쓰인다. 따라서, segment tree는 비추!. 나중에 업데이트 할 계획</p>
<h2 id="When"><a href="#When" class="headerlink" title="When"></a>When</h2><p>N개의 배열에서 특정 range(start, end)의 구간합을 구한다고 생각해보자. naive로 하면 O(N)이 걸린다.<br>각 배열의 값이 변하지 않는다고 가정하면 O(1)으로 값을 구할 수 있다. psum[N]을 선언하고 0~n까지의 합을 미리 계산하여 캐쉬하고 있으면 psum[end] - psum[start]로 구간합을 바로 구할 수 있다.<br>만약 각 배열의 값이 변한다면 가장 효율적인 방법은 무엇일까.. 이때 segement tree를 이용하면 된다.</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">time complexity</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">construction</td>
<td style="text-align:center"><a href="https://en.wikipedia.org/wiki/Segment_tree" target="_blank" rel="noopener">O(NlogN)</a></td>
</tr>
<tr>
<td style="text-align:center">query</td>
<td style="text-align:center">O(logN)</td>
</tr>
<tr>
<td style="text-align:center">update</td>
<td style="text-align:center">O(logN)</td>
</tr>
</tbody>
</table>
<h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><p>heap이랑 구조가 비슷하다. root는 모든 범위의 합을 가지고 있고(0 to N-1), left node는 왼쪽 반, right node는 오른쪽 반을 가지게 계속 나누어서 트리를 구성하면 된다. 각 노드는 자신의 범위를 가지고 그 범위의 구간합을 계산하여 가진다. left와 right의 값이 같아질때까지 이것을 반복하면 segment tree가 완성되게 된다.<br>예를 들어, 4개의 원소가 있는 구간트리를 도식화해 보면 아래처럼 구성 되게 된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">                  +--------+</span><br><span class="line">                  | (0,3)  |</span><br><span class="line">                  +--------+</span><br><span class="line">      +--------+              +--------+</span><br><span class="line">      |  (0,1) |              |  (2,3) |</span><br><span class="line">      +--------+              +--------+</span><br><span class="line">+--------+  +--------+   +--------+  +--------+</span><br><span class="line">|  (0,0) |  |  (1,1) |   |   (2,2)|  |  (3,3) |</span><br><span class="line">+--------+  +--------+   +--------+  +--------+</span><br></pre></td></tr></table></figure>
<h2 id="implementation"><a href="#implementation" class="headerlink" title="implementation"></a>implementation</h2><p>기본적으로 [start, end] 구간의 중간을 잡아서 왼쪽,오른쪽을 계속 recursive하게 수행하면 된다. 종료 조건은 start와 end가 같을때이다. 그리고 left child의 인덱스는 2<em>i+1이 되고, 오른쪽 차일드의 인덱스는 2</em>i+2가 된다.<br>그리고 트리의 길이는 원 배열 길이의 4배 정도를 잡아주면 된다.</p>
<h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><p>위 전제조건으로 구현해 보면 아래처럼 포현할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> a: input array</span></span><br><span class="line"><span class="comment">tree: segment tree</span></span><br><span class="line"><span class="comment"> i: index of segment tree</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span>* a, <span class="keyword">int</span>* tree, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (start==end)&#123;</span><br><span class="line">        tree[i] = a[start];</span><br><span class="line">        <span class="keyword">return</span> tree[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> m = (end-start)/<span class="number">2</span>;</span><br><span class="line">    tree[i] = build(a,tree, start, m, <span class="number">2</span>*i+<span class="number">1</span>) +</span><br><span class="line">        build(a, tree, m+<span class="number">1</span>, end, <span class="number">2</span>*i+<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> tree[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="query"><a href="#query" class="headerlink" title="query"></a>query</h4><p>세그먼트 트리를 만들었으니 이제 임의의 범위를 주면 그 합을 리턴해주는 query함수를 만들어 보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// start,end : start/end index of tree</span></span><br><span class="line"><span class="comment">// qs, qe : query start/end index</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span>*st, <span class="keyword">int</span> qs, <span class="keyword">int</span> qe, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 구간을 벗어남</span></span><br><span class="line">    <span class="keyword">if</span> (qe&lt;start || qs&gt;start)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 쿼리가 범위 안에 있음</span></span><br><span class="line">    <span class="keyword">if</span> (qs&lt;=start &amp;&amp; end&lt;=qe)&#123;</span><br><span class="line">        <span class="keyword">return</span> st[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 걸쳐 있는 경우</span></span><br><span class="line">    <span class="keyword">int</span> m = (end-start)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> query(st,qs,qe,start, m, <span class="number">2</span>*i+<span class="number">1</span>) + query(st, qs, qe, m+<span class="number">1</span>,end,<span class="number">2</span>*i+<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><p>원 배열의 값이 바뀔때 트리를 업데이트 해주는 함수. 해당 배열이 포함된 모든 노드의 값을 수정해 준다. O(logN)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span>*st, <span class="keyword">int</span> dest, <span class="keyword">int</span> orgValue, <span class="keyword">int</span> newValue)</span></span>&#123;</span><br><span class="line">    update2(st, dest, newValue-orgValue, <span class="number">0</span>, N-<span class="number">1</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update2</span><span class="params">(<span class="keyword">int</span>*st, <span class="keyword">int</span> dest, <span class="keyword">int</span> diff, <span class="keyword">int</span> s,<span class="keyword">int</span> e, <span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dest&lt;s || dest&gt;e) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    st[i] += diff;</span><br><span class="line">    <span class="keyword">if</span> (s==e)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m = (e-s)/<span class="number">2</span>;</span><br><span class="line">    update2(st, dest, diff, s, m, <span class="number">2</span>*i+<span class="number">1</span>);</span><br><span class="line">    update2(st, dest, diff, m+<span class="number">1</span>, e, <span class="number">2</span>*i+<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/11/16 initial draft</li>
<li>2016/11/8 typo fixed</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/11/10/segmenttree/" data-id="ckqe4m41p000hrcqy4fixrupw" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/11/10/segmenttree/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-tunneling" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/29/tunneling/">ssh tunneling on AWS</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/10/29/tunneling/" class="article-date"><time datetime="2015-10-29T15:00:00.000Z" itemprop="datePublished">2015-10-30</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>AWS EMR를 사용하다보면 보안등의 이유로 로컬로만 웹서비스등을 오픈해 놓았다. 그래서 web ui는 접속이 되더라도 제대로 동작하지 않다. YARN의 Resource Manager등도 개별 노드로 가는 노드들은 다 링크를 찾지 못한다. 각 링크들이 private ip로 되어 있기 때문이다. 제플린도 마찬가지로 웹은 뜨지만 제플린 서버로 접속을 하지 못해서 disconnted상태로 뜬다. 그래서 이럴땐 ssh tunneling을 사용하면 fully 접근하는 길이 열리게 된다.</p>
<p>아마존에서는 아래처럼 이렇게 가이드를 해놓았다.</p>
<blockquote>
<p>Hadoop, Ganglia, and other applications publish user interfaces as websites hosted on the master node. For security reasons, these websites are only available on the master node’s local webserver (<a href="http://localhost:port" target="_blank" rel="noopener">http://localhost:port</a>) and are not published on the Internet</p>
</blockquote>
<h2 id="ssh-tunneling"><a href="#ssh-tunneling" class="headerlink" title="ssh tunneling"></a>ssh tunneling</h2><p>나의 경우는 아래처럼 구성되어 있기 때문에 bastion으로 한번 터널링을 하고 bastion에서 다시 EMR master로 터널링을 해줘야 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+----------+         +---------+        +------------+</span><br><span class="line">|localhost | &lt;----&gt;  |bastion  |  &lt;---&gt; | EMR master |</span><br><span class="line">+----------+         +---------+        +------------+</span><br></pre></td></tr></table></figure>
<p>Zeppelin을 예로 들어서 터널링을 해보자. Zeppelin의 경우 emr-4.1에서 8890포트로 설정이 되어 있어서 우선 내 로컬의 8890포트를 bastion의 8890포트로 포워딩 시켜준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i &lt;your.pem&gt;  -L 8890:localhost:8890  ec2-user@bastion</span><br></pre></td></tr></table></figure>
<p>이렇게 하면 bastion으로 ssh 접속이 되었을 것이고 다시 EMR master로 8890 포트를 포워딩 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i &lt;your.pem&gt; -p 22 -L 8890:localhost:8890 hadoop@ec2-??-??-??-???.us-west-2.compute.amazonaws.com</span><br></pre></td></tr></table></figure>
<p>이렇게 하면 이제 EMR master로 ssh 접속이 된 상태일 것이고. 그러고 난 후 <a href="http://localhost:8890" target="_blank" rel="noopener">http://localhost:8890</a> 에 접속을 하면 제플린 웹에 접속할 수 있게 된다. 오른쪽 상단에 ‘connected’라고 되어 있을 것이다.</p>
<h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p>ssh 명령을 줄때 다음 옵션들을 경우에 맞게 사용하면 아주 유용.</p>
<ul>
<li>-v : verbose. 뭔가 잘 안될때 이 옵션을 사용하자</li>
<li>-N : ssh 접속을 하지 않는다.</li>
</ul>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/10/30 initial draft</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/10/29/tunneling/" data-id="ckqe4m41p000grcqyvlxn3bqt" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/10/29/tunneling/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-ssh-config" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/23/ssh-config/">ssh config</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/08/23/ssh-config/" class="article-date"><time datetime="2015-08-23T15:00:00.000Z" itemprop="datePublished">2015-08-24</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>aws를 사용하다보면 ssh 작업을 많이 하게 되는데, 이 때 알아두면 너무 너무 편리한 팁들이다.</p>
<h2 id="passwordless-ssh"><a href="#passwordless-ssh" class="headerlink" title="passwordless ssh"></a>passwordless ssh</h2><p>나의 public key(.ssh/id_rsa.pub)를 대상 컴의 .ssh/authrized_keys 에 복사해주면<br><code>ssh user@server ls /</code>를 패스워드 없이 바로 실행할 수 있다.</p>
<blockquote>
<p>cat ~/.ssh/id_rsa.pub | ssh stg ‘cat &gt;&gt; .ssh/authorized_keys’</p>
</blockquote>
<p>만약 .ssh 폴더가 없다면, <code>ssh-keygen -t rsa</code>로 생성해 주면 된다.</p>
<h2 id="ssh-config"><a href="#ssh-config" class="headerlink" title=".ssh/config"></a>.ssh/config</h2><p>ssh의 여러가지 설정을 담고 있는 설정 파일이다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host my</span><br><span class="line">     User darren</span><br><span class="line">     Hostname 10.1.1.1</span><br></pre></td></tr></table></figure>
<p>위 설정 파일을 사용하면 <code>ssh my</code>만 타이핑 하면, <code>ssh darren@10.1.1.1</code>로 번역되어 실행 된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host bas</span><br><span class="line">     User ec2-user</span><br><span class="line">     Hostname bastion</span><br><span class="line">     Port 352</span><br><span class="line">     IdentityFile ~/.ssh/bastion.pem</span><br></pre></td></tr></table></figure>
<p>위 설정 파일은 <code>ssh bas</code>를 <code>ssh -i ~/.ssh/bastion.pem ec2-user@bastion -p 352</code> 로 해석 된다.</p>
<h2 id="ssh-tunneling"><a href="#ssh-tunneling" class="headerlink" title="ssh tunneling"></a>ssh tunneling</h2><p>특정 포트를 포트 포워딩할 수도 있다. 보통 회사의 네트웍 같은 경우 80 포트를 제외한 나머지는 모두 방화벽으로 막혀 있는 경우가 많은데 이럴때 유용하게 사용할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host myserver</span><br><span class="line">    HostName mysql</span><br><span class="line">    IdentityFile ~/.ssh/mysql.key</span><br><span class="line">    LocalForward 9906 127.0.0.1:3306</span><br><span class="line">    User mysqlUser</span><br></pre></td></tr></table></figure>
<p>database컴의 3306 포트가 localhost:9906로 포트 포워딩 된다. localhost:9906에서 mysql의 port에 접근할 수 있다.</p>
<h2 id="ControlPath"><a href="#ControlPath" class="headerlink" title="ControlPath"></a>ControlPath</h2><p>control path를 사용하면 ssh connection을 캐쉬 해서 접속 시간을 줄일 수 있어, 반복적으로 ssh 명령을 불러야 할때 사용하면 유용하다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">	ControlPath            ~/.ssh/mux-%r@%h:%p</span><br></pre></td></tr></table></figure>
<h2 id="proxyCommand"><a href="#proxyCommand" class="headerlink" title="proxyCommand"></a>proxyCommand</h2><p>클라우드를 사용하면 회사 방화벽때문에 connector(bastion) 서버에 우선 접속한 뒤, 실제 서버로 연결해야 하는 경우가 많이 있다. 예를 들면 아래와 같은 경우.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+----------+         +---------+        +-----------+</span><br><span class="line">|localhost | &lt;----&gt;  |bastion  |  &lt;---&gt; | myserver  |</span><br><span class="line">+----------+         +---------+        +-----------+</span><br></pre></td></tr></table></figure>
<p>이런 경우 ssh를 두번 타고 들어가면 myserver까지 접속은 가능하다. 아래 처럼. -tt는 tty를 강제할당하는 명령임.</p>
<p><code>ssh -tt bas ssh -v -i &lt;key&gt;.pem ec2-user@myserver ls</code></p>
<p>이렇게 하면 명령어가 길어지므로, 아래처럼 proxyCommand를 사용하면 더 간편해 진다. proxyCommand는 ssh를 하기 전에 실행할 명령을 써 주는 용도로 사용되는데, 여기서는 미리 bas에 접속하여 tcp proxy를 설정하는 역할을 하게 된다. tcp proxy는 nc(netcat)를 통하여 동작한다. 아래처럼 셋팅이 되어 있으면, 위의 명령어가 <code>ssh myserver ls</code> 이렇게 간단해 진다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host myserver</span><br><span class="line">     User darren</span><br><span class="line">     Hostname 10.0.0.99</span><br><span class="line">     Port 22</span><br><span class="line">     IdentityFile ~/.ssh/mykey.pem</span><br><span class="line">     ProxyCommand ssh -qaY bas &apos;nc -w 14400 %h %p&apos;</span><br></pre></td></tr></table></figure>
<h2 id="run-multiple-bash-commands-with-ssh"><a href="#run-multiple-bash-commands-with-ssh" class="headerlink" title="run multiple bash commands with ssh"></a>run multiple bash commands with ssh</h2><p>bash의 <a href="http://tldp.org/LDP/abs/html/here-docs.html" target="_blank" rel="noopener">here document</a> 를 사용하면 된다. 아래 예제에서 <code>-o SendEnv</code>는 로컬의 환경변수를 remote로 전달하기 위해서 사용했다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ssh -o SendEnv=AWS_ACCESS_KEY_ID -o SendEnv=AWS_SECRET_ACCESS_KEY dev &lt;&lt;EOF</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$AWS_ACCESS_KEY_ID</span>, <span class="variable">$AWS_SECRET_ACCESS_KEY</span></span><br><span class="line"><span class="built_in">cd</span> /home/ec2-user</span><br><span class="line">sudo aws configure <span class="built_in">set</span> aws_access_key_id <span class="variable">$AWS_ACCESS_KEY_ID</span></span><br><span class="line">sudo aws configure <span class="built_in">set</span> aws_secret_access_key <span class="variable">$AWS_SECRET_ACCESS_KEY</span></span><br><span class="line">sudo aws configure <span class="built_in">set</span> default.region us-west-2</span><br><span class="line">ll</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://backdrift.org/transparent-proxy-with-ssh" target="_blank" rel="noopener">ssh proxy</a></li>
<li><a href="http://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/" target="_blank" rel="noopener">ssh portforward</a></li>
</ul>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/8/24 initial draft</li>
<li>8/28 ControlPath added</li>
<li>9/1 proxy command added</li>
<li>2017/3/29 added <code>run multiple bash commands</code></li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/08/23/ssh-config/" data-id="ckqe4m41o000frcqyyid0qdrl" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/08/23/ssh-config/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-emacs-helm" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/15/emacs-helm/">emacs helm</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/08/15/emacs-helm/" class="article-date"><time datetime="2015-08-15T15:00:00.000Z" itemprop="datePublished">2015-08-16</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>helm은 이맥스상에서 무엇인가를 선택할때(find-files, switch-buffer, recentf) 사용하는 프레임웍이다. 기존에는 ido-mode를 사용하고 있었는데 이번에 helm으로 바꾸면서 정리해 본다. 대부분의 내용은 레퍼런스에 있는 것을 번역한 수준임.</p>
<h2 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h2><p><code>M-x list-packages</code> 에서 `helm’ 패키지를 찾아서 설치한다.</p>
<h2 id="설정"><a href="#설정" class="headerlink" title="설정"></a>설정</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">require</span> 'helm-config)</span><br><span class="line">(<span class="name">helm-mode</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="사용법"><a href="#사용법" class="headerlink" title="사용법"></a>사용법</h2><p>기존의 tab-completion류의 것이랑은 다른 컨셉이라서 기본 설명이 필요할듯 하다.</p>
<ol>
<li>helm 모드에 들어가면 pattern을 입력한다.</li>
<li>pattern은 N개 입력이 가능하고, 각각은 공백으로 구분한다. pattern은 regex일 수도 있다</li>
<li>helm은 후보들 중에서 pattern과 매칭하는 후보들을 리스트 업 하고 RET로 선택</li>
<li><code>C-n</code>/<code>C-p</code> 로 아래/위로, <code>C-v</code> <code>M-v</code>로 아래페이지/위 페이지로 이동</li>
<li><code>C-spc</code>로 후보를 마크할 수 있다. <code>M-a</code>로 모두 다 선택이다.</li>
<li>mark한 파일 list를 <code>C-c C-i</code>로 현재 버퍼에 카피할 수 있다.</li>
<li><code>C-t</code>로 helm buffer를 vertical 또는 horizontal로 스위칭</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://tuhdo.github.io/helm-intro.html" target="_blank" rel="noopener">helm intro</a></li>
</ul>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/8/16 initial draft</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/08/15/emacs-helm/" data-id="ckqe4m41n000ercqy806kexll" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/08/15/emacs-helm/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/emacs/" rel="tag">emacs</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-mvn-assembly" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/30/mvn-assembly/">maven assembly plugin으로 패키징 해서 배포하기</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/07/30/mvn-assembly/" class="article-date"><time datetime="2015-07-30T15:00:00.000Z" itemprop="datePublished">2015-07-31</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>메이븐으로 프로젝트를 진행하다가 이 것을 배포해야 할때 configuration 파일들이나 헬퍼 스크립트 등을 디렉토리로 구성해서 zip/tar.gz으로 배포해야 할 필요가 있다. 그런것을 메이븐 상에서 가능하게 해주는 것이 maven assembly plugin 이다.</p>
<h2 id="mvn-configuration"><a href="#mvn-configuration" class="headerlink" title="mvn configuration"></a>mvn configuration</h2><p>우선 assembly plugin을 사용하기 위해서 build/plugins 하위에 명시해 준다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">descriptors</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">descriptor</span>&gt;</span>src/assemble/distribution.xml<span class="tag">&lt;/<span class="name">descriptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">descriptors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span> <span class="comment">&lt;!-- this is used for inheritance merges --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span> <span class="comment">&lt;!-- bind to the packaging phase --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>configuration 하위에 어떻게 assemble을 할지를 기술하는 assembly descriptor를 명시할 수 있다. 물론 복수개도 가능.</li>
<li>디폴트로 지원하는 descriptor도 있음. 예를 들면 jar-with-dependencies 같은 경우. 이것을 명시하면 fat-jar를 만들어 줌.</li>
<li>assembly:single goal만 유효함. 이것을 package phase에 실행하려면 위처럼 execution tag 하위에 phase와 goal을 명시하여 주면 됨.</li>
</ul>
<h2 id="assembly-descriptor"><a href="#assembly-descriptor" class="headerlink" title="assembly descriptor"></a>assembly descriptor</h2><p>moduleSet은 메이븐 모듈의 관점에서 처리를 하는 것이고. 소스, 바이너리등의 처리를 할 수 있다. 아래처럼 하면 소스들을 archive로 카피해 준다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">moduleSet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">useAllReactorProjects</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useAllReactorProjects</span>&gt;</span> <span class="comment">&lt;!--이것은 모든 모듈들에 대해서 처리를 하고 싶을때 사용한다. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span>&gt;</span>com.nberserk:core<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">sources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectoryMapping</span>&gt;</span></span><br><span class="line">      $&#123;module.basedir.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">outputDirectoryMapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">sources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">moduleSet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>반면 dependencySet은 각 모듈의 산출물과 디펜던시를 가지는 것의 산출물들을 어떻게 가져 올것 인지에 대해서 기술한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span>&gt;</span>com.nberserk:core<span class="tag">&lt;/<span class="name">include</span>&gt;</span> <span class="comment">&lt;!--core를 루트 드렉토리로 카피--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>com.nberserk:core<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span> <span class="comment">&lt;!--core가 refer하는 모든 jar들을 lib으로 카피--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>이 외에도 fileSet 을 사용해서 특정파일이나 폴더를 패키징할 수도 있다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fileSets</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>../<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.md<span class="tag">&lt;/<span class="name">include</span>&gt;</span>   <span class="comment">&lt;!--*.md 파일을 루트로 복사--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>../bin<span class="tag">&lt;/<span class="name">directory</span>&gt;</span> <span class="comment">&lt;!--bin디렉토리에 있는것을 bin으로 복사--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">directoryMode</span>&gt;</span>0755<span class="tag">&lt;/<span class="name">directoryMode</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileMode</span>&gt;</span>0755<span class="tag">&lt;/<span class="name">fileMode</span>&gt;</span>   <span class="comment">&lt;!--파일 모드를 변경해줌--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>../conf<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fileSets</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html" target="_blank" rel="noopener">assembly descriptor reference</a></li>
<li><a href="http://books.sonatype.com/mvnref-book/reference/index.html" target="_blank" rel="noopener">Maven:complete reference</a></li>
<li>실제로 동작하는 프로젝트 <a href="https://github.com/nberserk/sandbox/tree/master/mvn-assembly" target="_blank" rel="noopener">github</a>에 공유 되어 있음.</li>
</ul>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/7/32 initial draft</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/07/30/mvn-assembly/" data-id="ckqe4m41m000drcqy1214aj0n" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/07/30/mvn-assembly/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/" rel="tag">maven</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-swagger" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/15/swagger/">Swagger로 rest api 문서화 하기</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/07/15/swagger/" class="article-date"><time datetime="2015-07-15T15:00:00.000Z" itemprop="datePublished">2015-07-16</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>지난 번에 구현했던 <a href="!--￼4--&gt;/2015/07/13/rest-api.html">rest api</a> 프로젝트에 Swagger를 통해서 문서화 하고 rest api를 테스트 해 볼 수 있는 web ui를 만드는 방법을 소개합니다.</p>
<p>스웨거는 rest api를 문서화 하고 기술하는 스펙임. swagger.json 혹은 swagger.yaml이 곧 rest api의 명세를 작성하는 방법이 되는 것. 서브 프로젝트로</p>
<ul>
<li>swagger-editor : 스웨거 명세를 작성하게 도와주는 텍스트 에디터. <a href="http://editor.swagger.io/#/" target="_blank" rel="noopener">온라인 데모</a></li>
<li>swagger-ui: swagger api를 문서화 해서 보여주고 직접 rest api call도 해볼 수 있음 <a href="http://petstore.swagger.io/" target="_blank" rel="noopener">온라인 데모</a></li>
<li>swagger-codegen : swagger 명세를 기반으로 각 언어로 소스 뼈대를 만들어줌. Java, Scala, node 등을 지원해 줌.<br>등이 있고, 잘 사용하면 유용하게 사용할 수 있다.</li>
</ul>
<h2 id="swagger-integration"><a href="#swagger-integration" class="headerlink" title="swagger integration"></a>swagger integration</h2><p>먼저 pom.xml 에 swagger dependency를 추가하고</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.swagger&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;swagger-jersey2-jaxrs&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.5.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>web.xml. Jersey2Config는 swagger.json을 위한 것이고 기타 api.version과 basepath등을 여기서 설정해 준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;jersey&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.glassfish.jersey.servlet.ServletContainer&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;jersey.config.server.provider.packages&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;</span><br><span class="line">            io.swagger.jaxrs.listing,</span><br><span class="line">            com.nberserk.rest</span><br><span class="line">        &lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;Jersey2Config&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;io.swagger.jersey.config.JerseyJaxrsConfig&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;api.version&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;1.0.0&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;swagger.api.basepath&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;http://localhost:8080/rest&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Swagger로-annotation추가-하기"><a href="#Swagger로-annotation추가-하기" class="headerlink" title="Swagger로 annotation추가 하기"></a>Swagger로 annotation추가 하기</h2><p>이제 문서화를 할 차례다. Hello class에는 <code>@Api, @ApiOperation</code> annotation으로 Model class에는 <code>@ApiModel, @ApiModelProperty</code>로 annotation을 달아주면 나중에 swagger-ui로 보면 어노테이션한 설명들이 표시가 된다.</p>
<p>annotation된 Hello class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api</span>(value=<span class="string">"/hello"</span>, description=<span class="string">"hello APIs"</span>)</span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Model model;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        model = <span class="keyword">new</span> Model(<span class="string">"Darren"</span>);</span><br><span class="line">        model.setDesc(<span class="string">"description"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">""</span>, notes = <span class="string">"Gets model (text)"</span>, response = Model.class)</span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/text"</span>)</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces</span>(MediaType.TEXT_PLAIN)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> model.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">""</span>, notes = <span class="string">"Gets model (json)"</span>, response = Model.class)</span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/json"</span>)</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_JSON)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">getJson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.ok().entity(model).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">""</span>, notes = <span class="string">"Gets model (xml)"</span>, response = Model.class)</span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/xml"</span>)</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_XML)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">getXml</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.ok().entity(model).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>annotation된 Model class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ApiModel(description=<span class="string">"Model"</span>)</span><br><span class="line"><span class="meta">@XmlRootElement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    String id;</span><br><span class="line">    String desc;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Model</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(required = <span class="keyword">true</span>, value = <span class="string">"id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDesc</span><span class="params">(String desc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"description"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"id: "</span> + id + <span class="string">", desc: "</span> + desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swagger가 잘 설정되었는지를 보려면 브라우저로 <a href="http://localhost/rest/swagger.json" target="_blank" rel="noopener">rest/swagger.json</a> 여기 들어가서 json 파일이 보면 설정이 잘 된 것이다.</p>
<h2 id="swagger-ui"><a href="#swagger-ui" class="headerlink" title="swagger-ui"></a>swagger-ui</h2><p>자 이제 모든 준비는 끝났다. <a href="http://petstore.swagger.io/" target="_blank" rel="noopener">swagger-ui</a>에 가서 <code>http://localhost:8080/rest/swagger.json</code>을 입력하면 annotation에서 기술했던 정보들이 문서화 되어서 나오고, 여기서 바로 rest api를 불러 볼 수 도 있다. 모든 개발자는 문서화를 싫어하고, 소스와 싱크를 맞추는 일 또한 노력과 정성이 들어가기 때문에 소스에 annotation만 잘 해주면 싱크도 맞춰지니까 유용한 툴이 될 것이다. 아래 스크린샷 참고.</p>
<p><img src="/images/swagger-ui.png" alt="swagger-ui screenshot"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>실제로 동작하는 프로젝트는 <a href="https://github.com/nberserk/sandbox/tree/master/rest-jaxrs-swagger" target="_blank" rel="noopener">github에</a> 공유되어 있으니 참고하시면 되겠다.</p>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/7/14 initial draft</li>
<li>2015/7/17 rest/swagger 분리</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/07/15/swagger/" data-id="ckqe4m41l000brcqygu9lbjc9" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/07/15/swagger/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-rest-api" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/12/rest-api/">Jersey로 rest api 서버 만들기</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/07/12/rest-api/" class="article-date"><time datetime="2015-07-12T15:00:00.000Z" itemprop="datePublished">2015-07-13</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Jetty 를 이용해서 rest api 서버를 만들고 Jetty로 실행해 보는 코스.</p>
<h2 id="Jersey-로-rest-api-구현하기"><a href="#Jersey-로-rest-api-구현하기" class="headerlink" title="Jersey 로 rest api 구현하기"></a>Jersey 로 rest api 구현하기</h2><p>아래 처럼 maven 명령을 실행하면 프로젝트 구조를 만들어 준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DarchetypeArtifactId=jersey-quickstart-webapp -DarchetypeGroupId=org.glassfish.jersey.archetypes</span><br></pre></td></tr></table></figure>
<p>아래와 같은 파일들이 만들어 지고 ..</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rest/pom.xml</span><br><span class="line">rest/src/main</span><br><span class="line">rest/src/main/java/&lt;your package&gt;/MyResource.java</span><br><span class="line">rest/src/main/webapp/index.jsp</span><br><span class="line">rest/src/main/webapp/WEB-INF/web.xml</span><br></pre></td></tr></table></figure>
<p>이 중 MyResource.java가 리소스 파일이 되는데, 리네임해서 Hello.java로 만들자. 여기에 @Path만 붙여주면 rest api 처리하는 리소스 클래스가 된다. @GET, @POST ,@PUT , @DELETE 어노테이션을 하는 것만으로 쉽게 속성을 수정할 수 있다. 더구나 @Produces 를 사용해서 POJO class를 xml 혹은 json으로 인코딩 해서 보낼 수 있다. 멋지지 않는가? (아래의 Model class는 POJO class이다. 즉, 중요하지 않다.)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Path</span>(<span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Model model;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        model = <span class="keyword">new</span> Model(<span class="string">"Darren"</span>);</span><br><span class="line">        model.setDesc(<span class="string">"description"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/text"</span>)</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> model.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/json"</span>)</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_JSON)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">getJson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.ok().entity(model).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Path</span>(<span class="string">"/xml"</span>)</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_XML)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">getXml</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.ok().entity(model).build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Jetty로-실행해-보기"><a href="#Jetty로-실행해-보기" class="headerlink" title="Jetty로 실행해 보기"></a>Jetty로 실행해 보기</h2><p>앞단에서 rest api 구현은 해놨고 이것을 실행을 해야 하는데, tomcat등에 설치해서 하면 되지만 약간 무거운(?) 느낌이 있다. 그래서 light한 Jetty로 이 웹앱을 실행해 보자.</p>
<p>우선 jetty dependency를 pom.xml에 추가하고</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">	&lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;9.3.0.v20150612&lt;/version&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>
<p><code>mvn jetty:run</code>을 실행하면 localhost:8080으로 서버를 실행한다. 그러면 직접 rest api를 call 해 볼 수 있다. jetty:run이 무엇을 하는지 궁금하다면 <a href="http://www.eclipse.org/jetty/documentation/current/jetty-maven-plugin.html#jetty-run-goal" target="_blank" rel="noopener">여기</a> 를 보자. 내가 요약해주면 각 기본 디렉토리(src/main/webapp, classes in outdir)에 있는 파일들을 jetty로 deploy 해준다. 특정 파일에 변경이 생기면 업데이트 해주는 센스까지..</p>
<p>그럼 아래 url들을 차례로 브라우저에서 접근해보자. 각각 text, json, xml 포맷으로 response가 온다면 제대로 동작하고 있는 것.</p>
<ul>
<li><a href="http://localhost:8080/rest/text" target="_blank" rel="noopener">http://localhost:8080/rest/text</a></li>
<li><a href="http://localhost:8080/rest/json" target="_blank" rel="noopener">http://localhost:8080/rest/json</a></li>
<li><a href="http://localhost:8080/rest/xml" target="_blank" rel="noopener">http://localhost:8080/rest/xml</a></li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>실제로 동작하는 프로젝트는 <a href="https://github.com/nberserk/sandbox/tree/master/rest-jaxrs-swagger" target="_blank" rel="noopener">github에</a> 공유되어 있으니 참고하시면 되겠다.</p>
<h2 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h2><ul>
<li>2015/7/14 initial draft</li>
<li>2015/7/17 split to 2 posts. this one + swagger</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/07/12/rest-api/" data-id="ckqe4m41k000arcqy5ef6cfen" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/07/12/rest-api/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rest/" rel="tag">rest</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-spark-rdd" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/01/spark-rdd/">RDD transformation and actions</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/07/01/spark-rdd/" class="article-date"><time datetime="2015-07-01T15:00:00.000Z" itemprop="datePublished">2015-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Spark에서는 data를 RDD로 abstract한다. RDD는 distributable 하고, 하나의 노드가 사고로 죽었을때에도 다시 생성해 낼수 있다. 캐쉬의 단위이기도 하고 파일에 쓸 수 도 있다. 스파크의 기본 데이터 스트럭쳐 되겠다. RDD는 쉽게 생각해서 row의 묶음 이라고 생각하면 된다. 각 row가 transformation의 대상이 되는 것이고.</p>
<p>이 RDD는 크게 2개의 종류가 있고. 이는 transformation과 actions이다. transformation는 바로 실행하지 않고 defer될 수 있고 action이 일어날때 lazy 하게 실행된다. action은 collect, count, take 등이고, 나머지는 모두 transformation이다. 보면 당장의 결과가 필요한 애들만 action이다. 그래서 transformation이 lazy하게 시행될 수 있는 것이다.</p>
<h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><h4 id="map-flatMap"><a href="#map-flatMap" class="headerlink" title="map, flatMap"></a>map, flatMap</h4><p>가장 많이 사용하는 map! 은 말 그대로 하나의 입력을 인자로 주어지는 function을 통해서 다른 입력값으로 map 한다.</p>
<blockquote>
<p>아래 예제는 주어진 수를 제곱해주는 예제.</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="keyword">val</span> squared = rdd.map( n =&gt; n*n).collect</span><br><span class="line">--------------------------------------</span><br><span class="line">squared: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>)</span><br></pre></td></tr></table></figure>
<p>flatMap이 map과 다른 점은 interable한 값을 리턴하는 대신 그것을 flatten해서 변환한다는 것이다. 아래예제를 보면 split을 하게 되면 String array가 만들어지는데 이것을 개별로 리턴해준다. split vs split2 비교해보면 이해가 잘 될듯하다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="string">"a b"</span>,<span class="string">"v x"</span>))</span><br><span class="line"><span class="keyword">val</span> split = rdd.map( _.split(<span class="string">" "</span>)).collect</span><br><span class="line"><span class="keyword">val</span> split2 = rdd.flatMap( n =&gt; n.split(<span class="string">" "</span>)).collect</span><br><span class="line">--------------------------------------</span><br><span class="line">split: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">String</span>]] = <span class="type">Array</span>(<span class="type">Array</span>(a, b), <span class="type">Array</span>(v, x))</span><br><span class="line">split2: <span class="type">Array</span>[<span class="type">String</span>] = <span class="type">Array</span>(a, b, v, x)</span><br></pre></td></tr></table></figure>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>filter는 말그대로 true를 리턴하는 값만 가지고 나머지는 다 버리겠다는 것.</p>
<blockquote>
<p>1 부터 10까지의 수중 짝수만 남았다</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize((<span class="number">1</span> to <span class="number">10</span>).toList)</span><br><span class="line"><span class="keyword">val</span> filtered = rdd.filter(_ %<span class="number">2</span>==<span class="number">0</span>).collect</span><br><span class="line">--------------------------------------</span><br><span class="line">filtered: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h4 id="distinct-union-intersection-subtract"><a href="#distinct-union-intersection-subtract" class="headerlink" title="distinct, union, intersection, subtract"></a>distinct, union, intersection, subtract</h4><p>distinct는 중복값을 제거한후 리스트를 제공하고, union는 두 rdd의 합집합을, intersection은 교집합, subtract는 원집합에서 교집합을 제거 한다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="keyword">val</span> b = sc.parallelize(<span class="type">List</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> distinct_a = a.distinct.collect</span><br><span class="line"><span class="keyword">val</span> union_ab = a.union(b).collect</span><br><span class="line"><span class="keyword">val</span> intersect_ab = a.intersection(b).collect</span><br><span class="line"><span class="keyword">val</span> subtract_ab = a.subtract(b).collect</span><br><span class="line">-------------------------------------</span><br><span class="line">distinct_a: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">union_ab: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">intersect_ab: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">subtract_ab: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h4 id="cartesian"><a href="#cartesian" class="headerlink" title="cartesian"></a>cartesian</h4><p>두 rdd의 Cartesian product을 구한다. pair(a in A RDD,b in B RDD)로 나온다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cartesian</span></span><br><span class="line"><span class="keyword">val</span> users = sc.parallelize(<span class="type">List</span>(<span class="string">"darren"</span>, <span class="string">"andrew"</span>) )</span><br><span class="line"><span class="keyword">val</span> products = sc.parallelize(<span class="type">List</span>(<span class="string">"mac"</span>, <span class="string">"cellphone"</span>))</span><br><span class="line"><span class="keyword">val</span> cartesian = users.cartesian(products).collect</span><br><span class="line">-------------------------------------</span><br><span class="line">cartesian: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">String</span>)] = <span class="type">Array</span>((darren,mac), (darren,cellphone), (andrew,mac), (andrew,cellphone))</span><br></pre></td></tr></table></figure>
<h4 id="sample"><a href="#sample" class="headerlink" title="sample"></a>sample</h4><p>rdd중에서 주어진 확률값으로 샘플링한 rdd를 리턴한다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="number">1</span> to <span class="number">10</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> sampled = rdd.sample(<span class="literal">false</span>, <span class="number">0.2</span>).collect</span><br><span class="line">-------------------------------------</span><br><span class="line">sampled: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">3</span>, <span class="number">9</span>)</span><br></pre></td></tr></table></figure>
<h2 id="key-value-pair"><a href="#key-value-pair" class="headerlink" title="key/value pair"></a>key/value pair</h2><h4 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a>reduceByKey</h4><p>key가 값은 값을 tuple(u,v) 로 넘겨주면 이것을 어떻게 reduce할지 변환 함수를 주면 된다. 아래 예에서 <code>_+_</code> 는 그냥 두 값을 concatenate하라는 뜻이다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>((<span class="number">20</span>,<span class="string">"darren"</span>), (<span class="number">10</span>,<span class="string">"andrew"</span>), (<span class="number">10</span>, <span class="string">"Joy"</span>)))</span><br><span class="line"><span class="keyword">val</span> reduced = rdd.reduceByKey(_+_).collect</span><br><span class="line"><span class="keyword">val</span> reduced1 = rdd.reduceByKey( (u,v) =&gt; (<span class="string">s"<span class="subst">$u</span>|<span class="subst">$v</span>"</span>)).collect</span><br><span class="line">-------------------------------------</span><br><span class="line">reduced: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">String</span>)] = <span class="type">Array</span>((<span class="number">20</span>,darren), (<span class="number">10</span>,andrewJoy))</span><br><span class="line">reduced1: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">String</span>)] = <span class="type">Array</span>((<span class="number">20</span>,darren), (<span class="number">10</span>,andrew|<span class="type">Joy</span>))</span><br></pre></td></tr></table></figure>
<h4 id="keyBy"><a href="#keyBy" class="headerlink" title="keyBy"></a>keyBy</h4><p>각 값의 키를 만드는 함수를 제공해주면, RDD(K,V)를 리턴해준다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="string">"darren"</span>, <span class="string">"andrew"</span>, <span class="string">"Joy"</span>))</span><br><span class="line"><span class="keyword">val</span> tuples = rdd.keyBy(_.length).collect</span><br><span class="line">-------------------------------------</span><br><span class="line">tuples: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">String</span>)] = <span class="type">Array</span>((<span class="number">6</span>,darren), (<span class="number">6</span>,andrew), (<span class="number">3</span>,<span class="type">Joy</span>))</span><br></pre></td></tr></table></figure>
<h4 id="groupByKey"><a href="#groupByKey" class="headerlink" title="groupByKey"></a>groupByKey</h4><p>같은 키값을 가진 것끼리 묶어서 RDD[K, Interable[V]]를 리턴한다.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>((<span class="number">20</span>,<span class="string">"darren"</span>), (<span class="number">10</span>,<span class="string">"andrew"</span>), (<span class="number">10</span>, <span class="string">"Joy"</span>)))</span><br><span class="line"><span class="keyword">val</span> grouped = rdd.groupByKey.collect</span><br><span class="line">-------------------------------------</span><br><span class="line">grouped: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Iterable</span>[<span class="type">String</span>])] = <span class="type">Array</span>((<span class="number">10</span>,<span class="type">CompactBuffer</span>(andrew, <span class="type">Joy</span>)), (<span class="number">20</span>,<span class="type">CompactBuffer</span>(darren)))</span><br></pre></td></tr></table></figure>
<h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><p>(,) tuple 이어야만 가능한 rdd operation이다.<br>join은 교집합만<br>leftOuterJoin은 left 원본 + 교집합 머지<br>rightOuterJoin은 right원본 + 교집합 머지<br>fullOuterJoin은 left/right + 교집합 머지</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> t=sc.parallelize(<span class="type">Array</span>((<span class="string">"darren"</span>, <span class="string">"1"</span>), (<span class="string">"andrew"</span>, <span class="string">"v2"</span>)))</span><br><span class="line"><span class="keyword">val</span> t2 = sc.parallelize(<span class="type">Array</span>( (<span class="string">"darren"</span>,<span class="string">"33"</span>) ))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> joined = t.join(r2).collect</span><br><span class="line"><span class="keyword">val</span> leftJoined = t.leftOuterJoin(r2).collect</span><br><span class="line"><span class="keyword">val</span> rightJoined = t.rightOuterJoin(r2).collect</span><br><span class="line"><span class="keyword">val</span> fullJoined = t.fullOuterJoin(r2).collect</span><br><span class="line">-----------------------------------------------</span><br><span class="line">joined: <span class="type">Array</span>[(<span class="type">String</span>, (<span class="type">String</span>, <span class="type">String</span>))] = <span class="type">Array</span>((darren,(<span class="number">1</span>,<span class="number">33</span>)))</span><br><span class="line">leftJoined: <span class="type">Array</span>[(<span class="type">String</span>, (<span class="type">String</span>, <span class="type">Option</span>[<span class="type">String</span>]))] = <span class="type">Array</span>((andrew,(v2,<span class="type">None</span>)), (darren,(<span class="number">1</span>,<span class="type">Some</span>(<span class="number">33</span>))))</span><br><span class="line">rightJoined: <span class="type">Array</span>[(<span class="type">String</span>, (<span class="type">Option</span>[<span class="type">String</span>], <span class="type">String</span>))] = <span class="type">Array</span>((darren,(<span class="type">Some</span>(<span class="number">1</span>),<span class="number">33</span>)))</span><br><span class="line">fullJoined: <span class="type">Array</span>[(<span class="type">String</span>, (<span class="type">Option</span>[<span class="type">String</span>], <span class="type">Option</span>[<span class="type">String</span>]))] = <span class="type">Array</span>((andrew,(<span class="type">Some</span>(v2),<span class="type">None</span>)), (darren,(<span class="type">Some</span>(<span class="number">1</span>),<span class="type">Some</span>(<span class="number">33</span>))))</span><br></pre></td></tr></table></figure>
<h3 id="revision-history"><a href="#revision-history" class="headerlink" title="revision history"></a>revision history</h3><ul>
<li>2015/7/2 initial draft</li>
<li>2015/7/5 distinct/union/intersection/subtract added</li>
<li>2015/7/21 sample,reduceByKey, keyBy, groupByKey added</li>
<li>2016/1/25 join, leftOuterJoin, rightOuterJoin added</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://nberserk.github.io/2015/07/01/spark-rdd/" data-id="ckqe4m41l000crcqyjv2zbp6i" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://nberserk.github.io/2015/07/01/spark-rdd/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/" rel="tag">spark</a></li></ul>


    </footer>
  </div>
  
</article>



  


  <div id="page-nav">
    <nav><ul class="pagination"><li><a class="page-prev" rel="prev" href="/page/8/"><i class="fa fa-chevron-left"></i> Prev</a></li><li><a class="page-number" href="/">1</a></li><li class="disabled"><span class="page-space">&hellip;</span></li><li><a class="page-number" href="/page/7/">7</a></li><li><a class="page-number" href="/page/8/">8</a></li><li class="active"><span class="page-number">9</span></li><li><a class="page-number" href="/page/10/">10</a></li><li><a class="page-next" rel="next" href="/page/10/">Next <i class="fa fa-chevron-right"></i></a></li></ul></nav>
  </div>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p>Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.</p>

</div>


  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/algorithm/">algorithm</a><span class="sidebar-module-list-count">5</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list" itemprop="keywords"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/CVA/" rel="tag">CVA</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/algorithm/" rel="tag">algorithm</a><span class="sidebar-module-list-count">15</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/angular/" rel="tag">angular</a><span class="sidebar-module-list-count">6</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/aws/" rel="tag">aws</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/c/" rel="tag">c++</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/checkstyle/" rel="tag">checkstyle</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/cloud-architecture/" rel="tag">cloud architecture</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/coverage/" rel="tag">coverage</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/design/" rel="tag">design</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/django/" rel="tag">django</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/docker/" rel="tag">docker</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/dp/" rel="tag">dp</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/dynamo/" rel="tag">dynamo</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/emacs/" rel="tag">emacs</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/emr/" rel="tag">emr</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/fzf/" rel="tag">fzf</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/general/" rel="tag">general</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/gerrit/" rel="tag">gerrit</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/git/" rel="tag">git</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/github/" rel="tag">github</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/google/" rel="tag">google</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/graph/" rel="tag">graph</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/hadoop/" rel="tag">hadoop</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/invoke/" rel="tag">invoke</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/jacoco/" rel="tag">jacoco</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/java/" rel="tag">java</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/jekyll/" rel="tag">jekyll</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/jenkins/" rel="tag">jenkins</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/kibana/" rel="tag">kibana</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/mailchimp/" rel="tag">mailchimp</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/maven/" rel="tag">maven</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/mgmt/" rel="tag">mgmt</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/mockito/" rel="tag">mockito</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/mybatis/" rel="tag">mybatis</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/nosql/" rel="tag">nosql</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/proxy/" rel="tag">proxy</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/rake/" rel="tag">rake</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/regex/" rel="tag">regex</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/rest/" rel="tag">rest</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ripgrep/" rel="tag">ripgrep</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ruby/" rel="tag">ruby</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/spark/" rel="tag">spark</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/spring-in-action/" rel="tag">spring in action</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/spring-in-actions/" rel="tag">spring in actions</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/sql/" rel="tag">sql</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ssh/" rel="tag">ssh</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/swagger/" rel="tag">swagger</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/system-design/" rel="tag">system design</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/template/" rel="tag">template</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/tmux/" rel="tag">tmux</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/tree/" rel="tag">tree</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/vscode/" rel="tag">vscode</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/wordgrep/" rel="tag">wordgrep</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/zeppelin/" rel="tag">zeppelin</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/CVA/" style="font-size: 10px;">CVA</a> <a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/angular/" style="font-size: 17.14px;">angular</a> <a href="/tags/aws/" style="font-size: 15.71px;">aws</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/checkstyle/" style="font-size: 10px;">checkstyle</a> <a href="/tags/cloud-architecture/" style="font-size: 11.43px;">cloud architecture</a> <a href="/tags/coverage/" style="font-size: 10px;">coverage</a> <a href="/tags/design/" style="font-size: 12.86px;">design</a> <a href="/tags/django/" style="font-size: 11.43px;">django</a> <a href="/tags/docker/" style="font-size: 15.71px;">docker</a> <a href="/tags/dp/" style="font-size: 10px;">dp</a> <a href="/tags/dynamo/" style="font-size: 11.43px;">dynamo</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/emacs/" style="font-size: 10px;">emacs</a> <a href="/tags/emr/" style="font-size: 11.43px;">emr</a> <a href="/tags/fzf/" style="font-size: 10px;">fzf</a> <a href="/tags/general/" style="font-size: 10px;">general</a> <a href="/tags/gerrit/" style="font-size: 10px;">gerrit</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/graph/" style="font-size: 10px;">graph</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/invoke/" style="font-size: 10px;">invoke</a> <a href="/tags/jacoco/" style="font-size: 10px;">jacoco</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/kibana/" style="font-size: 10px;">kibana</a> <a href="/tags/mailchimp/" style="font-size: 10px;">mailchimp</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mgmt/" style="font-size: 10px;">mgmt</a> <a href="/tags/mockito/" style="font-size: 10px;">mockito</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/mysql/" style="font-size: 11.43px;">mysql</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/oauth/" style="font-size: 10px;">oauth</a> <a href="/tags/proxy/" style="font-size: 10px;">proxy</a> <a href="/tags/rake/" style="font-size: 10px;">rake</a> <a href="/tags/regex/" style="font-size: 10px;">regex</a> <a href="/tags/rest/" style="font-size: 10px;">rest</a> <a href="/tags/ripgrep/" style="font-size: 10px;">ripgrep</a> <a href="/tags/ruby/" style="font-size: 10px;">ruby</a> <a href="/tags/spark/" style="font-size: 18.57px;">spark</a> <a href="/tags/spring-in-action/" style="font-size: 14.29px;">spring in action</a> <a href="/tags/spring-in-actions/" style="font-size: 10px;">spring in actions</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/ssh/" style="font-size: 11.43px;">ssh</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/system-design/" style="font-size: 11.43px;">system design</a> <a href="/tags/template/" style="font-size: 10px;">template</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/tree/" style="font-size: 10px;">tree</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/wordgrep/" style="font-size: 10px;">wordgrep</a> <a href="/tags/zeppelin/" style="font-size: 10px;">zeppelin</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2021/06/">6월 2021</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/09/">9월 2020</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/04/">4월 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/11/">11월 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/08/">8월 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/05/">5월 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/04/">4월 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/02/">2월 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/01/">1월 2019</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/12/">12월 2018</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/11/">11월 2018</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/10/">10월 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/08/">8월 2018</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/07/">7월 2018</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/06/">6월 2018</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/05/">5월 2018</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/04/">4월 2018</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/03/">3월 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/02/">2월 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/01/">1월 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/12/">12월 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/11/">11월 2017</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/10/">10월 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/09/">9월 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/07/">7월 2017</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/03/">3월 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/02/">2월 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/12/">12월 2016</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/11/">11월 2016</a><span class="sidebar-module-list-count">12</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/07/">7월 2016</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/06/">6월 2016</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/04/">4월 2016</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/03/">3월 2016</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/02/">2월 2016</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/01/">1월 2016</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/12/">12월 2015</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/11/">11월 2015</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/10/">10월 2015</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/08/">8월 2015</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/07/">7월 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/06/">6월 2015</a><span class="sidebar-module-list-count">5</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2021/06/26/select-db/">select the right db</a>
        </li>
      
        <li>
          <a href="/2021/06/26/rate-limiter/">Rate limiting service</a>
        </li>
      
        <li>
          <a href="/2021/06/13/top-K-problem/">Top K problem</a>
        </li>
      
        <li>
          <a href="/2021/06/12/distributed-cache/">Design distributed Cache</a>
        </li>
      
        <li>
          <a href="/2021/06/03/distributed-message-queue/">distribute message queue</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2022 @nberserk<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  
<script>
  var disqus_shortname = 'nberserk';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>




<script src="/js/script.js"></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
